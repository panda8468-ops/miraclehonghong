<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奇迹宏宏 - 换装游戏</title>
    <style>
        /* --- 样式区域 (CSS) --- */
        :root {
            --bg-color: #fce4ec; /* 背景色 */
            --sidebar-width: 40%; /* 左侧宽度 */
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: "Microsoft YaHei", sans-serif; background-color: var(--bg-color); }

        /* 布局容器 */
        .container { display: flex; height: 100%; }

        /* 左侧：衣橱与功能 */
        .sidebar {
            width: var(--sidebar-width);
            background: #fff;
            display: flex;
            flex-direction: column;
            border-right: 2px solid #ff69b4;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* 衣橱列表区域 */
        .wardrobe-list { 
            flex: 1; 
            overflow-y: auto; 
            padding: 10px; 
        }
        
        .category-title {
            background: #ff80ab;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            margin-top: 10px;
        }
        
        .icon-grid {
            display: grid;
            /* 自适应列数：根据容器宽度自动调整列数 */
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            padding: 5px 0;
            justify-content: start; /* 左对齐 */
            transition: max-height 0.3s ease;
        }

        .icon-grid.collapsed { display: none; }

        .item-icon {
            /* 固定宽高比，保持圆形 */
            aspect-ratio: 1 / 1;
            background: #f5f5f5;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, border-color 0.2s;
            /* 根据容器宽度动态调整大小的基础样式 */
            max-width: 100%;
        }

        .item-icon:hover {
            transform: scale(1.1);
        }

        .item-icon img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .item-icon.selected { border-color: #4caf50; background: #e8f5e9; }
        /* 最后穿上的衣服 - 粉红色 */
        .item-icon.last-worn { border-color: #ff4081; background: #ffebee; }

        /* 左侧底部按钮区 */
        .controls {
            height: 120px;
            background: #eee;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;
            padding: 5px;
            border-top: 1px solid #ccc;
        }

        .control-btn {
            width: 45%;
            height: 40px;
            background-size: 100% auto; /* 宽度拉伸适应，高度自动按比例缩放 */
            background-repeat: no-repeat;
            background-position: center;
            background-color: transparent; /* 占位色，有图后可透明 */
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        
        /* 只是为了演示，如果没有图片显示文字 */
        .control-btn span { 
            font-size: 14px; 
            font-weight: bold; 
            color: #ff69b4; /* 粉色 */
        }
        
        /* 一键脱衣按钮文字 */
        .control-btn.btn-strip span {
            color: #fff; /* 白色 */
        }

        /* 右侧：展示区 */
        .stage {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: radial-gradient(#fff 20%, transparent 20%);
            background-size: 20px 20px;
        }

        /* 角色层级容器 */
        .character-container {
            width: 100%;
            height: 100%;
            position: relative;
            max-width: 600px; /* 限制最大宽度 */
        }

        /* 衣服图片通用样式 */
        .clothing-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none; /* 让点击穿透到底层 */
            transition: transform 0.2s; /* 上下移时的动画 */
        }

        /* 对话框 */
        .dialog-box {
            position: absolute;
            top: 10%;
            right: 10%;
            background: white;
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #333;
            max-width: 150px;
            display: none; /* 默认隐藏 */
            animation: float 2s infinite ease-in-out;
            z-index: 999;
        }
        .dialog-box:after {
            content: ''; position: absolute; bottom: -10px; right: 20px;
            border-width: 10px 10px 0; border-style: solid;
            border-color: #333 transparent; display: block; width: 0;
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* 底部统计 */
        .footer-stats {
            position: absolute;
            bottom: 10px;
            width: 100%;
            text-align: center;
            color: #666;
            font-size: 12px;
            text-shadow: 1px 1px 0 #fff;
            z-index: 100;
        }

        /* 视频层 - 在右侧展示区播放 */
        #video-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: black; display: none; z-index: 2000;
        }
        #video-overlay video { width: 100%; height: 100%; object-fit: contain; }

        /* 让宏宏决定按钮 */
        .random-btn {
            position: absolute;
            bottom: 50px;
            right: 10px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ff69b4, #ff80ab);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
            z-index: 100;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .random-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(255, 105, 180, 0.6);
        }
        .random-btn:active {
            transform: scale(0.95);
        }

        /* 响应式调整 - 大屏幕 (>=1200px) */
        @media (min-width: 1200px) {
            :root {
                --sidebar-width: 35%; /* 大屏幕稍微减小左侧宽度 */
            }
            
            .category-title {
                font-size: 16px;
                padding: 10px 15px;
            }
            
            .icon-grid {
                gap: 12px;
            }
            
            .item-icon {
                min-width: 55px;
            }
        }

        /* 中等屏幕 (768px - 1199px) */
        @media (max-width: 1199px) and (min-width: 768px) {
            :root {
                --sidebar-width: 40%;
            }
            
            .category-title {
                font-size: 14px;
                padding: 8px 12px;
            }
            
            .icon-grid {
                gap: 10px;
            }
            
            .item-icon {
                min-width: 48px;
            }
        }

        /* 小屏幕 (<768px) */
        @media (max-width: 767px) {
            :root {
                --sidebar-width: 45%; /* 手机端增加左侧宽度 */
            }
            
            .category-title {
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .icon-grid {
                gap: 6px;
            }
            
            .item-icon {
                min-width: 42px;
            }
            
            .control-btn span {
                font-size: 12px;
            }
            
            .random-btn {
                padding: 8px 16px;
                font-size: 12px;
                bottom: 40px;
            }
            
            .footer-stats {
                font-size: 10px;
            }
        }

        /* 超小屏幕 (<480px) */
        @media (max-width: 479px) {
            :root {
                --sidebar-width: 50%; /* 超小屏幕左侧占一半 */
            }
            
            .category-title {
                font-size: 11px;
                padding: 5px 8px;
            }
            
            .icon-grid {
                gap: 4px;
            }
            
            .item-icon {
                min-width: 38px;
            }
            
            .controls {
                height: 100px;
            }
            
            .control-btn span {
                font-size: 10px;
            }
            
            .random-btn {
                padding: 6px 12px;
                font-size: 10px;
                bottom: 30px;
                right: 5px;
            }
        }

    </style>
</head>
<body>

<div class="container">
    <!-- 左侧区域 -->
    <div class="sidebar">
        <div class="wardrobe-list" id="wardrobe-container">
            <!-- JS会自动在这里生成列表 -->
        </div>

        <div class="controls">
            <!-- 功能按钮 -->
            <button class="control-btn" onclick="moveLayer(1)" style="background-image: url('assets/ui/btn_up.png')"><span>上移一层</span></button>
            <button class="control-btn" onclick="moveLayer(-1)" style="background-image: url('assets/ui/btn_down.png')"><span>下移一层</span></button>
            <button class="control-btn" onclick="undo()" style="background-image: url('assets/ui/btn_undo.png')"><span>上一步</span></button>
            <button class="control-btn btn-strip" onclick="handleStrip()" style="background-image: url('assets/ui/btn_strip.png')"><span>一键脱衣</span></button>
        </div>
    </div>

    <!-- 右侧区域 -->
    <div class="stage" onclick="resetIdleTimer()">
        <div class="character-container" id="character-container">
            <!-- 素体 (Layer 0) -->
            <img src="assets/clothing/body.png" class="clothing-layer" style="z-index: 0" alt="body">
            <!-- 衣服会通过JS动态插入到这里 -->
        </div>

        <!-- 气泡对话框 -->
        <div class="dialog-box" id="dialog"></div>

        <!-- 视频层 - 在右侧展示区播放 -->
        <div id="video-overlay">
            <video id="bonus-video" onended="closeVideo()">
                <source src="assets/video/surprise.mp4" type="video/mp4">
            </video>
        </div>

        <!-- 底部统计 -->
        <div class="footer-stats" id="stats">Styled by 第 loading... 位 奇迹宏宏搭配师</div>
        
        <!-- 让宏宏决定按钮 -->
        <button class="random-btn" onclick="randomOutfit()">让宏宏决定</button>
    </div>
</div>

<script>
    /* ================= 配置区域 (在这里修改文件名) ================= */
    
    // 需求 4.2 定义的层级映射
    // 这里的 Key 是文件名包含的关键字，Value 是默认Z-index
    const LAYER_RULES = [
        { key: 'body', z: 0 },
        { key: 'T', z: 1 }, { key: 'shirt', z: 1 }, { key: 'knit', z: 1 }, { key: 'hoodie', z: 1 }, // 上衣
        { key: 'med', z: 2 }, // 中层
        { key: 'coat', z: 6 }, // 外套
        { key: 'bottom', z: 3 }, // 裤子 
        { key: 'shoes', z: 4 }, // 鞋子
        { key: 'tie', z: 5 }, // 配饰 (上衣层级之上)
        { key: 'head', z: 7 }  // 头饰
    ];

    // *重要*：请在这里把你的所有图片文件名列出来 (不带路径)
    // 只要文件名包含上面的关键字，程序就会自动识别分类
    const ASSET_DATABASE = [
        // 示例数据，请替换为你真实的文件名
        "bottom1001.png", "bottom1002.png", "bottom1003.png", "coat1001-1.png",
        "coat1001-2.png",
        "coat1002-1.png", "coat1002-2.png",
        "coat1003.png", "coat1004.png",
        "coat1005.png", "coat1006.png", "coat1007-1.png", "coat1007-2.png", "coat1008-1.png", "coat1008-2.png", "coat1009.png","hoodie1001.png","knit1001-1.png","med1001.png","med1002.png",
        "tie1001-1.png","tie1001-2.png","tie1002-1.png","tie1002-2.png","tie1003-1.png","tie1003-2.png","shirt1001.png","shirt1002.png","shirt1003.png","shirt1004.png",
        "shoes1001.png","shoes1002.png","shoes1003.png", "T1001-1.png","T1001-2.png","T1002-1.png","T1003-1.png"
    ];

    const CONFIG = {
        iconPath: "assets/icon/",
        clothPath: "assets/clothing/",
        idleTime: 60000 // 1分钟 = 60000毫秒
    };

    /* ================= 核心逻辑 (建议不要乱动) ================= */

    // 状态管理
    let currentOutfit = {}; // 当前穿了什么 { type: filename }
    let historyStack = [];  // 历史记录
    let currentSelection = null; // 当前选中的衣服类型 (用于上下移层)
    let layerOffsets = {};  // 用于记录用户手动调整的层级 { type: offsetValue }
    let lastWornItem = null; // 最后穿上的衣服 { category: filename }，用于标记选中状态
    let idleTimer = null;

    // 初始化
    window.onload = function() {
        renderWardrobe();
        initStats();
        resetIdleTimer();
        // 绑定全局点击重置计时
        document.body.onclick = resetIdleTimer;
        
        // 延迟执行布局调整，确保DOM已完全渲染
        setTimeout(adjustLayout, 100);
        // 监听窗口大小变化，实时调整布局
        window.addEventListener('resize', adjustLayout);
    };

    // 调试日志：记录屏幕和容器尺寸
    function logLayoutInfo() {
        const screenWidth = window.innerWidth;
        const sidebarWidth = document.querySelector('.sidebar')?.offsetWidth || 0;
        const containerWidth = document.querySelector('.wardrobe-list')?.offsetWidth || 0;
        console.log(`屏幕宽度: ${screenWidth}px, 侧边栏宽度: ${sidebarWidth}px, 容器宽度: ${containerWidth}px`);
        
        // 检查每个分类的物品数量
        const grids = document.querySelectorAll('.icon-grid');
        grids.forEach(grid => {
            const itemCount = grid.querySelectorAll('.item-icon').length;
            const categoryName = grid.previousElementSibling?.querySelector('span')?.innerText || 'Unknown';
            console.log(`分类 ${categoryName}: ${itemCount} 个物品`);
        });
    }

    // 根据容器宽度动态调整布局
    function adjustLayout() {
        const containerWidth = document.querySelector('.wardrobe-list')?.offsetWidth || 200;
        const grids = document.querySelectorAll('.icon-grid');
        
        grids.forEach(grid => {
            const itemCount = grid.querySelectorAll('.item-icon').length;
            
            // 根据容器宽度和物品数量计算最优列数
            // 容器宽度约200-400px，物品数量1-10个
            let optimalCols;
            if (containerWidth < 200) {
                optimalCols = itemCount <= 2 ? itemCount : 2;
            } else if (containerWidth < 300) {
                optimalCols = itemCount <= 3 ? itemCount : 3;
            } else if (containerWidth < 400) {
                optimalCols = itemCount <= 4 ? itemCount : 4;
            } else {
                optimalCols = Math.min(itemCount, Math.floor(containerWidth / 60));
            }
            
            // 应用计算的列数
            grid.style.gridTemplateColumns = `repeat(${Math.max(optimalCols, 1)}, 1fr)`;
        });
        
        // 记录布局调整信息
        console.log(`容器宽度: ${containerWidth}px, 已调整 ${grids.length} 个分类的布局`);
    }

    // 1. 渲染左侧衣橱
    function renderWardrobe() {
        // 添加调试日志
        logLayoutInfo();
        
        const categories = {
            '上衣': ['T', 'shirt', 'knit', 'hoodie'],
            '马甲': ['med'],
            '外套': ['coat'],
            '裤子': ['bottom'],
            '鞋子': ['shoes'],
            '配饰': ['tie', 'acc'],
            '头饰': ['head']
        };

        const container = document.getElementById('wardrobe-container');

        for (let [catName, keywords] of Object.entries(categories)) {
            // 筛选属于该分类的图片
            const items = ASSET_DATABASE.filter(filename => 
                keywords.some(k => filename.includes(k))
            );
            if (items.length === 0) continue;

            // 创建标题
            const title = document.createElement('div');
            title.className = 'category-title';
            title.innerHTML = `<span>${catName.toUpperCase()}</span> <span>▼</span>`;
            title.onclick = function() {
                this.nextElementSibling.classList.toggle('collapsed');
            };
            container.appendChild(title);

            // 创建Grid
            const grid = document.createElement('div');
            grid.className = 'icon-grid';
            
            items.forEach(filename => {
                const div = document.createElement('div');
                div.className = 'item-icon';
                div.dataset.category = catName; // 添加分类标识
                div.onclick = () => toggleWear(catName, filename, div);
                
                // 自动查找icon路径
                const img = document.createElement('img');
                img.src = CONFIG.iconPath + filename; 
                // 错误处理：如果找不到icon，尝试直接用原图缩小显示
                img.onerror = function() { this.src = CONFIG.clothPath + filename; };
                
                div.appendChild(img);
                grid.appendChild(div);
                
                // 保存引用以便更新选中状态
                div.dataset.filename = filename;
            });
            container.appendChild(grid);
        }
    }

    // 2. 穿衣/脱衣 核心逻辑
    function toggleWear(category, filename, domElement) {
        saveHistory(); // 记录一步历史
        
        currentSelection = category; // 标记当前选中的分类

        // 如果已经穿了这件，就脱掉
        if (currentOutfit[category] === filename) {
            delete currentOutfit[category];
            // 如果脱掉的是最后穿上的，清空lastWornItem
            if (lastWornItem && lastWornItem.category === category && lastWornItem.filename === filename) {
                lastWornItem = null;
            }
        } else {
            currentOutfit[category] = filename;
            // 记录最后穿上的衣服
            lastWornItem = { category: category, filename: filename };
        }

        // 重置该部件的手动层级偏移
        layerOffsets[category] = 0;

        updateUI();
        updateCharacter();
    }

    // 3. 更新UI高亮
    function updateUI() {
        // 按分类分组，判断选中状态
        document.querySelectorAll('.item-icon').forEach(el => {
            const cat = el.dataset.category;
            const fname = el.dataset.filename;
            const isWorn = (currentOutfit[cat] === fname);
            const isLastWorn = (lastWornItem && lastWornItem.category === cat && lastWornItem.filename === fname);
            
            if (isLastWorn) {
                // 最后穿上的 - 粉红色高亮
                el.classList.remove('selected');
                el.classList.add('last-worn');
            } else if (isWorn) {
                // 已穿上但不是最后的 - 绿色高亮
                el.classList.remove('last-worn');
                el.classList.add('selected');
            } else {
                // 未穿上的
                el.classList.remove('selected', 'last-worn');
            }
        });
    }

    // 4. 更新右侧角色 (最关键的逻辑)
    function updateCharacter() {
        const charContainer = document.getElementById('character-container');
        // 清除除了body以外的所有图层
        const layers = charContainer.querySelectorAll('img:not([alt="body"])');
        layers.forEach(el => el.remove());

        // 遍历当前穿的每一件
        for (let [cat, filename] of Object.entries(currentOutfit)) {
            const img = document.createElement('img');
            img.className = 'clothing-layer';
            
            // 直接使用文件名作为图片路径
            img.src = CONFIG.clothPath + filename;

            // --- 计算层级 ---
            let baseZ = 0;
            // 根据文件名关键字匹配默认Z
            for (let rule of LAYER_RULES) {
                if (filename.includes(rule.key)) {
                    baseZ = rule.z;
                    break;
                }
            }
            // 加上手动调节的偏移量
            const offset = layerOffsets[cat] || 0;
            img.style.zIndex = baseZ + offset;

            charContainer.appendChild(img);
        }
    }

    // 5. 按钮功能
    function moveLayer(direction) {
        if (!currentSelection || !currentOutfit[currentSelection]) {
            alert("请先选择一件身上的衣服！");
            return;
        }
        
        // 获取当前层级规则
        let baseZ = 0;
        const filename = currentOutfit[currentSelection];
        for (let rule of LAYER_RULES) {
            if (filename.includes(rule.key)) {
                baseZ = rule.z;
                break;
            }
        }
        
        // 初始化当前偏移
        if (!layerOffsets[currentSelection]) layerOffsets[currentSelection] = 0;
        
        // 计算新偏移
        let newOffset = layerOffsets[currentSelection] + direction;
        let newZ = baseZ + newOffset;
        
        // 层级约束规则
        let isValid = true;
        const errorMsg = "该类别无法继续调整层级";
        
        switch(currentSelection) {
            case '上衣': // 上衣只能在外套层级下 (z < 6)
                if (newZ >= 6) isValid = false;
                break;
            case '马甲': // 中层只能在外套层级下 (z < 6)
                if (newZ >= 6) isValid = false;
                break;
            case '裤子': // 裤子只能在外套层级下body层级上 (z=1~5)
                // body z=0, 外套 z=6, 裤子可选 z=1~5
                if (newZ < 1 || newZ >= 6) isValid = false;
                break;
            case '鞋子': // 鞋子只能在裤子上一层或下一层 (z=2,3,4)
                // 裤子z=3, 鞋子可选z=2,3,4
                if (newZ < 2 || newZ > 4) isValid = false;
                break;
            case '配饰': // 配饰不能在外套层级上 (z < 6)
                if (newZ >= 6) isValid = false;
                break;
            // 头饰、外套无限制
        }
        
        // body是z=0，不能移到body以下
        if (newZ <= 0) isValid = false;
        
        if (!isValid) {
            alert(errorMsg);
            return;
        }
        
        // 应用偏移
        layerOffsets[currentSelection] = newOffset;
        updateCharacter();
    }

    function saveHistory() {
        // 深拷贝当前状态
        historyStack.push({
            outfit: JSON.stringify(currentOutfit),
            offsets: JSON.stringify(layerOffsets),
            lastWorn: JSON.stringify(lastWornItem)
        });
        if (historyStack.length > 20) historyStack.shift(); // 限制步数
    }

    function undo() {
        if (historyStack.length === 0) return;
        const lastState = historyStack.pop();
        currentOutfit = JSON.parse(lastState.outfit);
        layerOffsets = JSON.parse(lastState.offsets);
        lastWornItem = lastState.lastWorn ? JSON.parse(lastState.lastWorn) : null;
        updateUI();
        updateCharacter();
    }

    function handleStrip() {
        const keys = Object.keys(currentOutfit);
        if (keys.length > 0) {
            // 还有衣服，脱掉
            saveHistory();
            currentOutfit = {};
            layerOffsets = {};
            lastWornItem = null; // 清空最后穿上记录
            updateUI();
            updateCharacter();
        } else {
            // 已经是裸体，播放视频
            document.getElementById('video-overlay').style.display = 'block';
            document.getElementById('bonus-video').play();
        }
    }
    
    function closeVideo() {
        const video = document.getElementById('bonus-video');
        document.getElementById('video-overlay').style.display = 'none';
        video.pause();
        video.currentTime = 0; // 重置视频到开头
    }

    // 6. 闲置对话框 (每分钟循环触发)
    function resetIdleTimer() {
        const dialog = document.getElementById('dialog');
        dialog.style.display = 'none';
        
        clearTimeout(idleTimer);
        idleTimer = setTimeout(() => {
            const texts = [
                "老师，还没给宏宏选好衣服吗",
                "没关系慢慢选，宏宏可以等的",
                "选那么久，宏宏好期待啊",
                "没有挑到心仪的衣服吗？去StayReal店铺看看吧"
            ];
            const randomText = texts[Math.floor(Math.random() * texts.length)];
            dialog.innerText = randomText;
            dialog.style.display = 'block';
            
            // 显示对话后，自动重新计时，每分钟再次触发
            resetIdleTimer();
        }, CONFIG.idleTime);
    }

    // 7. 访问统计 (模拟)
    function initStats() {
        // 注意：localStorage 只能记录当前浏览器的次数，无法记录全网总次数。
        // 全网统计需要后端服务器支持。这里仅演示逻辑。
        let count = localStorage.getItem('visit_count');
        if (!count) count = 5524; // 假装已经有很多人了
        count = parseInt(count) + 1;
        localStorage.setItem('visit_count', count);
        document.getElementById('stats').innerText = `Styled by 第 ${count} 位 奇迹宏宏搭配师` + "\n" + `Developed by 小红书 熊貓団子`;
    }

    // 8. 让宏宏决定 - 随机穿搭
    function randomOutfit() {
        saveHistory(); // 记录历史
        
        // 清空当前穿搭
        currentOutfit = {};
        layerOffsets = {};
        lastWornItem = null;
        
        // 定义需要随机选择的分类（排除配饰和头饰，这两个是可选的）
        const categories = {
            '上衣': ['T', 'shirt', 'knit', 'hoodie'],
            '马甲': ['med'],
            '外套': ['coat'],
            '裤子': ['bottom'],
            '鞋子': ['shoes']
        };
        
        // 从每个分类中随机选择一件
        for (let [catName, keywords] of Object.entries(categories)) {
            const items = ASSET_DATABASE.filter(filename => 
                keywords.some(k => filename.includes(k))
            );
            if (items.length > 0) {
                const randomItem = items[Math.floor(Math.random() * items.length)];
                currentOutfit[catName] = randomItem;
            }
        }
        
        // 记录最后穿上的（设为第一件随机选择的）
        const randomCats = Object.keys(currentOutfit);
        if (randomCats.length > 0) {
            lastWornItem = {
                category: randomCats[0],
                filename: currentOutfit[randomCats[0]]
            };
        }
        
        // 更新UI和角色
        updateUI();
        updateCharacter();
        
        // 延迟显示得意的对话框，确保在resetIdleTimer执行后
        setTimeout(() => {
            const dialog = document.getElementById('dialog');
            dialog.innerText = "宏宏自己搭配的，帅吧o(=•ェ•=)m";
            dialog.style.display = 'block';
        }, 100);
    }

</script>
</body>
</html>
